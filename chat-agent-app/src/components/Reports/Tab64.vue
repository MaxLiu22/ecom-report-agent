<template>
  <div class="container">
    <header>
      <h1>BIXDå¤´ç¨‹çœé’±è®¡ç®—å™¨<br><span class="subtitle">BIXD Cost Calculator</span></h1>
      
      <div class="description">
        <button class="description-toggle" @click="toggleDescription">
          <span>â„¹ï¸</span>
          <span>{{ showDescription ? 'æ”¶èµ·è¯¦æƒ… Hide Details' : 'ä»€ä¹ˆæ˜¯BIXD (Bounded Warehouse)ï¼ŸWhat is BIXD (Bounded Warehouse)?' }}</span>
        </button>
        <div v-show="showDescription" class="description-content">
          <h3>ä»€ä¹ˆæ˜¯BIXD (Bounded Warehouse)ï¼Ÿ</h3>
          <p>äºšé©¬é€Šè‹±æ¬§å¤´ç¨‹æ•´åˆè®¡åˆ’ (BIXD) é€šè¿‡åˆå¹¶è‹±å¾·è´§ä»¶è‡³è·å…°ä¿ç¨ä»“ï¼Œå¸®åŠ©å–å®¶ï¼š</p>
          <ul>
            <li><strong>å»¶è¿Ÿåˆ†ä»“å†³ç­–</strong>ï¼šè´§ä»¶æŠµè·å…°å‰2.5å‘¨å¯è°ƒæ•´åº“å­˜åˆ†é…</li>
            <li><strong>ç®€åŒ–ç‰©æµ</strong>ï¼šäºšé©¬é€Šç«¯åˆ°ç«¯è¿è¾“+æ¸…å…³ï¼ˆå½“å‰æ”¯æŒè‹±å›½ä¸å¾·å›½ï¼‰</li>
          </ul>
          
          <h3>BIXDæ ¸å¿ƒä¼˜åŠ¿</h3>
          <ul>
            <li>ğŸ’° <strong>é™æœ¬15%+</strong>ï¼šåˆå¹¶å°è´§å‡‘æ•´æŸœï¼Œè§„æ¨¡ç»æµé™ä½å•ä»·</li>
            <li>ğŸ“¦ <strong>ç»Ÿä¸€ç®¡ç†</strong>ï¼šå•ç¥¨è´§ä»¶è¿½è¸ªï¼Œå‡å°‘è¿è¥è´Ÿæ‹…</li>
            <li>ğŸ“Š <strong>ç²¾å‡†é¢„æµ‹</strong>ï¼šå»¶ååˆ†ä»“å†³ç­–ï¼Œé¿å…åº“å­˜åå·®</li>
            <li>ğŸ›ƒ <strong>æ¸…å…³é«˜æ•ˆ</strong>ï¼šä¸€æ¬¡ç”³æŠ¥ï¼Œé€æ˜æŸ¥éªŒï¼Œç¨ç‡ç®€åŒ–</li>
          </ul>
        </div>
      </div>
    </header>

    <div class="bixd-intro">
      <div class="intro-title">ä»€ä¹ˆæ˜¯BIXD (Bounded Warehouse)ï¼Ÿ</div>
      <div class="intro-content">
        äºšé©¬é€Šè‹±æ¬§å¤´ç¨‹æ•´åˆè®¡åˆ’(BIXD)æ˜¯ä¸€é¡¹ç®€åŒ–è‹±å›½ä¸æ¬§ç›Ÿå¤´ç¨‹å…¥ä»“çš„è§£å†³æ–¹æ¡ˆï¼šå–å®¶å¯ä»¥æŠŠå‘å¾€è‹±å›½å’Œæ¬§ç›Ÿï¼ˆåŒ…æ‹¬å¾·å›½ã€è¥¿ç­ç‰™ã€æ³•å›½ã€æ„å¤§åˆ©å’Œæ³¢å…°ç­‰å›½å®¶ï¼‰çš„è´§ä»¶åˆå¹¶æˆä¸€ä¸ªè´§ä»¶ï¼Œç»Ÿä¸€å‘å¾€ä½äºè·å…°çš„äºšé©¬é€Šä¿ç¨ä»“ã€‚åœ¨è´§ä»¶æŠµè¾¾è·å…°æ¸¯å£å‰çº¦2.5å‘¨ï¼Œå–å®¶å¯ä»¥æ ¹æ®å®é™…å¸‚åœºéœ€æ±‚ï¼Œçµæ´»å†³å®šè‹±æ¬§ä¸¤åœ°çš„åº“å­˜åˆ†ä»“æ•°é‡ã€‚éšåï¼Œäºšé©¬é€Šå…¨çƒç‰©æµå°†è´Ÿè´£ç«¯åˆ°ç«¯è¿è¾“å’Œæ¸…å…³ä¸šåŠ¡ï¼Œå¹¶æ ¹æ®å–å®¶çš„åˆ†ä»“å†³ç­–ï¼Œå°†è´§ç‰©è°ƒæ‹¨è‡³è‹±å›½å’Œæ¬§ç›Ÿç›¸åº”çš„ç‰©æµä¸­å¿ƒã€‚è¿™ä¸€åˆ›æ–°æ¨¡å¼è®©å–å®¶èƒ½å¤Ÿå»¶è¿Ÿç‰©æµå†³ç­–ï¼Œå®ç°æ›´æ™ºèƒ½çš„åº“å­˜ç®¡ç†ã€‚
      </div>
      
      <div class="advantages">
        <div class="advantage-card advantage-1">
          <h4>ğŸ’° æ›´å¥½çš„ç°é‡‘æµç®¡ç†</h4>
          <p>åˆå¹¶è¾ƒå°è´§è¿ï¼ˆå°æ–¹æ•°å˜å¤§æ–¹æ•°ï¼Œå‡‘æ•´æŸœæ¦‚ç‡æ›´é«˜ï¼‰å®ç°è§„æ¨¡ç»æµï¼Œé™ä½æ¯å•ä½è¿è¾“æˆæœ¬ï¼Œä¸åˆ†å¤šæ‰¹è£…è¿ç›¸æ¯”å¯èŠ‚çœè‡³å°‘çº¦15%çš„è¿è´¹</p>
        </div>
        <div class="advantage-card advantage-2">
          <h4>ğŸ“¦ æ›´ä¾¿æ·çš„è´§ä»¶ç®¡ç†</h4>
          <p>ä¸€ä¸ªåˆå¹¶è´§ä»¶å‘é€è‡³è·å…°ä¿ç¨ä»“ï¼Œæ— éœ€ç®¡ç†å•ç‹¬çš„è‹±å›½å’Œæ¬§ç›Ÿè´§è¿ã€‚ç»Ÿä¸€è´§ä»¶è¿½è¸ªï¼Œäºšé©¬é€Šè´Ÿè´£æ‰€æœ‰åŒºåŸŸåˆ†ç±»å’Œé…é€ï¼Œå‡å°‘è¿è¥å·¥ä½œé‡</p>
        </div>
        <div class="advantage-card advantage-3">
          <h4>ğŸ“Š æ›´ç²¾å‡†çš„é”€å”®é¢„æµ‹</h4>
          <p>å»¶åç‰©æµå†³ç­–ï¼ˆå¯åœ¨èˆ¹é æ¸¯å‰2.5å‘¨å†è¡Œå†³ç­–ï¼‰ï¼Œä½¿é”€å”®é¢„æµ‹æ›´åŠ å‡†ç¡®ï¼Œé¿å…ç¼ºè´§æˆ–å†—ä½™åº“å­˜çš„é—®é¢˜</p>
        </div>
        <div class="advantage-card advantage-4">
          <h4>ğŸ›ƒ æ›´é«˜æ•ˆçš„æ¸…å…³æœåŠ¡</h4>
          <p>äºšé©¬é€Šå…¨çƒç‰©æµå®˜æ–¹ç®¡ç†çš„æ¸…å…³è¡Œä¿é©¾æŠ¤èˆªï¼Œåªéœ€ä¸€æ¬¡æ¸…å…³æ–‡ä»¶ã€‚ç®€åŒ–ç”³æŠ¥æ–‡ä»¶ã€æŸ¥éªŒè¿›åº¦é€æ˜ã€ç¨ç‡è®¡ç®—ç®€å•ã€æ”¯æŒé€’å»¶</p>
        </div>
      </div>
      
      <div class="description" style="margin-top: 20px;">
        <button class="description-toggle" @click="toggleEnglishVersion">
          <span>ğŸ‡ºğŸ‡¸</span>
          <span>{{ showEnglishVersion ? 'Hide English Version' : 'English Version' }}</span>
        </button>
        <div v-show="showEnglishVersion" class="description-content">
          <div class="intro-title">What is BIXD (Bounded Warehouse)?</div>
          <div class="intro-content">
            BIXD is a streamlined shipping solution pilot program that allows you to send one consolidated shipment from China to both UK and EU marketplaces through our bonded facility in the Netherlands (NL). With Amazon Global Logistics managing end-to-end transportation and customs brokerage, you can make smarter inventory decisions just 2.5 weeks before your stock arrives at its destination.
          </div>
          
          <div class="advantages">
            <div class="advantage-card advantage-1">
              <h4>ğŸ’° Enhanced Cash Flow Management</h4>
              <p>BIXD allows sellers to consolidate smaller shipments into larger volumes, effectively converting LCL to FCL shipments. This consolidation enables better economies of scale, significantly reducing per-unit shipping costs. Compared to split shipments, sellers can achieve approximately 15% savings on shipping expenses, directly improving their cash flow management.</p>
            </div>
            <div class="advantage-card advantage-2">
              <h4>ğŸ“¦ Simplified Shipment Management</h4>
              <p>Instead of managing separate shipments for the UK and EU markets, sellers can now send one consolidated shipment to the Netherlands bonded warehouse. This unified approach provides seamless tracking and monitoring of all inventory movements. Amazon takes full responsibility for regional sorting and distribution, substantially reducing sellers' operational workload and simplifying their logistics management process.</p>
            </div>
            <div class="advantage-card advantage-3">
              <h4>ğŸ“Š More Accurate Sales Forecasting</h4>
              <p>BIXD introduces a flexible logistics decision-making timeline, allowing sellers to make final inventory allocation decisions just 2.5 weeks before vessel arrival. This delayed decision point enables sellers to base their distribution choices on recent sales data, resulting in more precise sales forecasting and inventory planning. This feature significantly reduces the risks of stockouts or excess inventory across different regions.</p>
            </div>
            <div class="advantage-card advantage-4">
              <h4>ğŸ›ƒ Professional Customs Handling</h4>
              <p>The program offers professional customs handling through Amazon-managed customs brokers, streamlining the entire clearance process. Sellers benefit from a single customs documentation requirement, transparent inspection progress, and simplified tax calculations. The service also supports deferred customs clearance, making the entire process more efficient and hassle-free for sellers while maintaining full compliance with regulatory requirements.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="calculator">
      <div class="section-title">é€šè¿‡BIXDå‡ºè¿ Ship w/ BIXD</div>
      
      <form @submit.prevent="calculateCost">
        <div class="form-group">
          <label for="port">å‡ºè¿æ¸¯å£ Shipping City</label>
          <select v-model="formData.port" @change="updatePriceTable" required>
            <option value="">è¯·é€‰æ‹©æ¸¯å£ Select Port</option>
            <option value="shanghai">ä¸Šæµ· Shanghai</option>
            <option value="shenzhen">æ·±åœ³ Shenzhen</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="ukVolume">è‹±å›½è´§ä»¶ UK Shipment (CBMç«‹æ–¹ç±³)</label>
            <input type="number" v-model.number="formData.ukVolume" @input="updateVolumeHint" step="0.01" min="0" placeholder="0.00">
          </div>
          <div class="form-group">
            <label for="deVolume">å¾·å›½è´§ä»¶ DE Shipment (CBMç«‹æ–¹ç±³)</label>
            <input type="number" v-model.number="formData.deVolume" @input="updateVolumeHint" step="0.01" min="0" placeholder="0.00">
            <div class="price-hint" v-html="volumeHint"></div>
          </div>
        </div>

        <div v-show="formData.port" class="price-table">
          <table>
            <thead>
              <tr>
                <th>è´§é‡åŒºé—´ Volume (CBMç«‹æ–¹ç±³)</th>
                <th>å•ä»· Price per CBMç«‹æ–¹ç±³ (äººæ°‘å¸Â¥)</th>
                <th>å›ºå®šè´¹ç”¨ Fixed Fee (äººæ°‘å¸Â¥)</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(tier, index) in currentPriceTiers" :key="index" :class="{ highlighted: highlightedTier === index }">
                <td>{{ formatTierRange(tier, index) }}</td>
                <td>{{ tier.price.toFixed(2) }}</td>
                <td>{{ tier.fixedFee.toFixed(2) }}</td>
              </tr>
            </tbody>
          </table>
          <div class="fixed-fee-note">*å›ºå®šè´¹ç”¨å«æ¸…å…³åŠè°ƒæ‹¨ Fixed fee includes customs clearance and allocation</div>
        </div>

        <div class="form-section">
          <div class="section-title">ä¸ä½¿ç”¨BIXDå‡ºè¿ Not Ship w/ BIXD</div>
          
          <div class="form-group">
            <label for="alternativeOption">é€‰æ‹©å‡ºè¿æ–¹å¼ Choose Shipping Method</label>
            <select v-model="formData.alternativeOption" required>
              <option value="">è¯·é€‰æ‹© Please Select</option>
              <option value="agl">ä½¿ç”¨AGLå‡ºè¿ Ship w/ AGL</option>
              <option value="3pl">ä½¿ç”¨ä¸‰æ–¹æ‰¿è¿å•†å‡ºè¿ Ship w/ 3PL carrier</option>
            </select>
          </div>

          <div v-show="formData.alternativeOption === '3pl'">
            <div class="country-section">
              <div class="country-title">ğŸ‡¬ğŸ‡§ è‹±å›½è´§ä»¶ UK Shipment</div>
              <div class="form-row">
                <div class="form-group">
                  <label for="ukUnitPrice">å•ä»· Price per CBMç«‹æ–¹ç±³ (Â¥)</label>
                  <input type="number" v-model.number="formData.ukUnitPrice" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                  <label for="ukClearanceFee">æ¸…å…³è´¹ç”¨ Customs Fee (Â¥)</label>
                  <input type="number" v-model.number="formData.ukClearanceFee" step="0.01" min="0" placeholder="0.00">
                </div>
              </div>
            </div>

            <div class="country-section">
              <div class="country-title">ğŸ‡©ğŸ‡ª å¾·å›½è´§ä»¶ DE Shipment</div>
              <div class="form-row">
                <div class="form-group">
                  <label for="deUnitPrice">å•ä»· Price per CBMç«‹æ–¹ç±³ (Â¥)</label>
                  <input type="number" v-model.number="formData.deUnitPrice" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                  <label for="deClearanceFee">æ¸…å…³è´¹ç”¨ Customs Fee (Â¥)</label>
                  <input type="number" v-model.number="formData.deClearanceFee" step="0.01" min="0" placeholder="0.00">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="shipmentDate">é¢„è®¡åˆ›å»ºè´§ä»¶æ—¥æœŸ Booking Date</label>
          <input type="date" v-model="formData.shipmentDate" required>
        </div>

        <button type="submit" class="calculate-btn">è®¡ç®—æˆæœ¬å¯¹æ¯” Compare Cost</button>
      </form>

      <div v-show="showResults" class="results">
        <h3>æˆæœ¬å¯¹æ¯”ç»“æœ Cost Saving</h3>
        <div class="comparison">
          <div class="cost-item bixd">
            <h4>BIXDæ–¹æ¡ˆ BIXD Solution</h4>
            <div class="price">{{ formatCurrency(results.bixdTotal) }}</div>
            <div class="discount">{{ results.discountInfo }}</div>
          </div>
          <div class="cost-item current">
            <h4>{{ results.alternativeTitle }}</h4>
            <div class="price">{{ formatCurrency(results.currentTotal) }}</div>
          </div>
        </div>
        <div class="savings" :style="savingsStyle">
          <div v-show="results.showEarlyBird" class="early-bird-tag">æ—©é¸Ÿ8æŠ˜ Early Bird 20% OFF</div>
          <div class="amount">{{ results.savingsText }}</div>
          <div class="percentage">({{ Math.abs(results.savingsPercentage).toFixed(1) }}%)</div>
        </div>
      </div>
    </div>

    <footer class="disclaimer">
      <p><strong>å…è´£å£°æ˜ Disclaimer:</strong></p>
      <p>1) æ•°æ®åŸºäºAGLä»·å¡ï¼Œç”Ÿæ•ˆæ—¥æœŸï¼š2025å¹´7æœˆ16æ—¥ | Data based on AGL price card, effective date: July 16, 2025</p>
      <p>2) æŠ¥ä»·åŒ…å«ï¼šå¯è¿æ¸¯è‡³äºšé©¬é€Šä¸­å¿ƒçš„è·¨å¢ƒç‰©æµè´¹ï¼ˆè¯¦æƒ…å’¨è¯¢å®¢æˆ·ç»ç†ï¼‰ | Quote includes: Cross-border logistics from departure port to Amazon centers (consult account manager for details)</p>
      <p>3) ä¸åŒ…å«ï¼šå…³ç¨ã€ä¿é™©è´¹ã€æŸ¥éªŒè´¹ç­‰éä»£ç†æœåŠ¡è´¹ç”¨ | Excludes: Duties, insurance, inspection fees and other non-agency service costs</p>
      <p style="margin-top: 10px; font-size: 11px;">æœ€åæ›´æ–° Last Updated: {{ lastUpdate }}</p>
    </footer>
  </div>
</template>

<script>
export default {
  name: 'BIXDCostCalculator',
  data() {
    return {
      showDescription: false,
      showEnglishVersion: false,
      showResults: false,
      highlightedTier: -1,
      volumeHint: '',
      formData: {
        port: '',
        ukVolume: 0,
        deVolume: 0,
        alternativeOption: '',
        ukUnitPrice: 0,
        ukClearanceFee: 0,
        deUnitPrice: 0,
        deClearanceFee: 0,
        shipmentDate: new Date().toISOString().split('T')[0]
      },
      results: {
        bixdTotal: 0,
        currentTotal: 0,
        discountInfo: '',
        alternativeTitle: '',
        savingsText: '',
        savingsPercentage: 0,
        showEarlyBird: false
      },
      priceCard: {
        shanghai: [
          { min: 0, max: 5, price: 728.77, fixedFee: 1055.66 },
          { min: 5, max: 10, price: 692.35, fixedFee: 1055.66 },
          { min: 10, max: 15, price: 638.16, fixedFee: 1055.66 },
          { min: 15, max: Infinity, price: 624.84, fixedFee: 1055.66 }
        ],
        shenzhen: [
          { min: 0, max: 5, price: 741.00, fixedFee: 1188.72 },
          { min: 5, max: 10, price: 704.58, fixedFee: 1188.72 },
          { min: 10, max: 15, price: 650.39, fixedFee: 1188.72 },
          { min: 15, max: Infinity, price: 643.10, fixedFee: 1188.72 }
        ]
      },
      aglPriceCard: {
        shanghai: {
          uk: [
            { min: 1, max: 5, price: 631.38, fixedFee: 667.80 },
            { min: 5, max: 10, price: 607.22, fixedFee: 667.80 },
            { min: 10, max: 15, price: 557.95, fixedFee: 667.80 },
            { min: 15, max: Infinity, price: 497.94, fixedFee: 667.80 }
          ],
          de: [
            { min: 1, max: 5, price: 728.77, fixedFee: 1055.66 },
            { min: 5, max: 10, price: 692.35, fixedFee: 1055.66 },
            { min: 10, max: 15, price: 638.16, fixedFee: 1055.66 },
            { min: 15, max: Infinity, price: 624.84, fixedFee: 1055.66 }
          ]
        },
        shenzhen: {
          uk: [
            { min: 1, max: 5, price: 642.04, fixedFee: 800.86 },
            { min: 5, max: 10, price: 617.88, fixedFee: 800.86 },
            { min: 10, max: 15, price: 568.61, fixedFee: 800.86 },
            { min: 15, max: Infinity, price: 508.59, fixedFee: 800.86 }
          ],
          de: [
            { min: 1, max: 5, price: 741.00, fixedFee: 1188.72 },
            { min: 5, max: 10, price: 704.58, fixedFee: 1188.72 },
            { min: 10, max: 15, price: 650.39, fixedFee: 1188.72 },
            { min: 15, max: Infinity, price: 643.10, fixedFee: 1188.72 }
          ]
        }
      },
      discountRules: [
        { startDate: "2025-06-01", endDate: "2025-09-30", discount: 0.8, name: "å¤å­£8æŠ˜" },
        { startDate: "2025-10-01", endDate: "2025-10-30", discount: 0.9, name: "ç§‹å­£9æŠ˜" },
        { startDate: "2025-11-01", endDate: "2025-12-31", discount: 1.0, name: "æ— æŠ˜æ‰£" }
      ]
    }
  },
  computed: {
    currentPriceTiers() {
      return this.formData.port ? this.priceCard[this.formData.port] : []
    },
    savingsStyle() {
      const savings = this.results.currentTotal - this.results.bixdTotal
      if (savings > 0) {
        return { background: 'linear-gradient(135deg, #27ae60, #2ecc71)' }
      } else if (savings < 0) {
        return { background: 'linear-gradient(135deg, #e74c3c, #c0392b)' }
      } else {
        return { background: 'linear-gradient(135deg, #95a5a6, #7f8c8d)' }
      }
    },
    lastUpdate() {
      return new Date().toLocaleString('zh-CN') + ' / ' + new Date().toLocaleString('en-US')
    }
  },
  methods: {
    toggleDescription() {
      this.showDescription = !this.showDescription
    },
    toggleEnglishVersion() {
      this.showEnglishVersion = !this.showEnglishVersion
    },
    updatePriceTable() {
      this.updateVolumeHint()
    },
    updateVolumeHint() {
      const totalVolume = (this.formData.ukVolume || 0) + (this.formData.deVolume || 0)
      const tier = this.getTieredPrice(this.formData.port, totalVolume)
      
      this.highlightedTier = -1
      let hintText = ''
      
      if (tier && totalVolume > 0) {
        const tiers = this.priceCard[this.formData.port]
        const tierIndex = tiers.findIndex(t => t === tier)
        this.highlightedTier = tierIndex
        
        let rangeText
        if (tierIndex === 0) {
          rangeText = `1-${tier.max}CBMç«‹æ–¹ç±³`
        } else if (tier.max === Infinity) {
          rangeText = `>${tier.min}CBMç«‹æ–¹ç±³`
        } else {
          rangeText = `${tier.min}-${tier.max}CBMç«‹æ–¹ç±³`
        }
        
        hintText = `é€šè¿‡BIXDæ•´åˆè‹±å›½å’Œå¾·å›½è´§ä»¶åï¼Œæ‚¨çš„æ€»è´§é‡ä¸º${totalVolume.toFixed(2)}CBMç«‹æ–¹ç±³ï¼Œæ»¡è¶³${rangeText}åŒºé—´ï¼Œè¿è´¹å•ä»·ä¸ºÂ¥${tier.price.toFixed(2)}/CBMç«‹æ–¹ç±³ï¼Œå›ºå®šè´¹ç”¨ä¸ºÂ¥${tier.fixedFee.toFixed(2)}`
      }
      
      if (totalVolume >= 68) {
        if (hintText) hintText += '<br>'
        hintText += '<span style="color: #7f8c8d;">æ€»è´§é‡è¶…è¿‡40HQæŸœï¼Œå¦‚éœ€æ•´æŸœæœåŠ¡ï¼Œè¯·è¯¦è¯¢å®¢æˆ·ç»ç†ã€‚</span>'
      }
      
      this.volumeHint = hintText
    },
    getTieredPrice(port, volume) {
      const adjustedVolume = Math.max(volume, 1)
      const tiers = this.priceCard[port]
      if (!tiers) return null
      
      for (const tier of tiers) {
        if (adjustedVolume >= tier.min && adjustedVolume <= tier.max) {
          return tier
        }
      }
      return tiers[tiers.length - 1]
    },
    getAglTieredPrice(port, country, volume) {
      const adjustedVolume = Math.max(volume, 1)
      const tiers = this.aglPriceCard[port][country]
      if (!tiers) return null
      
      for (const tier of tiers) {
        if (adjustedVolume >= tier.min && adjustedVolume <= tier.max) {
          return tier
        }
      }
      return tiers[tiers.length - 1]
    },
    getApplicableDiscount(date) {
      const checkDate = new Date(date)
      for (const rule of this.discountRules) {
        const start = new Date(rule.startDate)
        const end = new Date(rule.endDate)
        if (checkDate >= start && checkDate <= end) {
          return rule
        }
      }
      return { discount: 1.0, name: "æ— æŠ˜æ‰£" }
    },
    calculateBixdCost(port, ukVolume, deVolume, shipmentDate) {
      const totalVolume = ukVolume + deVolume
      const adjustedTotalVolume = Math.max(totalVolume, 1)
      const tier = this.getTieredPrice(port, adjustedTotalVolume)
      if (!tier) return { total: 0, discount: null }

      const baseCost = (adjustedTotalVolume * tier.price) + tier.fixedFee
      const discount = this.getApplicableDiscount(shipmentDate)
      const finalCost = baseCost * discount.discount

      return {
        total: finalCost,
        baseCost: baseCost,
        discount: discount,
        tier: tier
      }
    },
    calculateAglCost(port, ukVolume, deVolume) {
      const adjustedUkVolume = Math.max(ukVolume, ukVolume > 0 ? 1 : 0)
      const adjustedDeVolume = Math.max(deVolume, deVolume > 0 ? 1 : 0)
      
      let ukCost = 0
      let deCost = 0
      
      if (adjustedUkVolume > 0) {
        const ukTier = this.getAglTieredPrice(port, 'uk', adjustedUkVolume)
        if (ukTier) {
          ukCost = (adjustedUkVolume * ukTier.price) + ukTier.fixedFee
        }
      }
      
      if (adjustedDeVolume > 0) {
        const deTier = this.getAglTieredPrice(port, 'de', adjustedDeVolume)
        if (deTier) {
          deCost = (adjustedDeVolume * deTier.price) + deTier.fixedFee
        }
      }
      
      return ukCost + deCost
    },
    calculateCurrentCost(ukPrice, ukFee, dePrice, deFee, ukVolume, deVolume) {
      const adjustedUkVolume = Math.max(ukVolume, ukVolume > 0 ? 1 : 0)
      const adjustedDeVolume = Math.max(deVolume, deVolume > 0 ? 1 : 0)
      return (adjustedUkVolume * ukPrice + ukFee) + (adjustedDeVolume * dePrice + deFee)
    },
    formatCurrency(amount) {
      return `Â¥${amount.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
    },
    formatTierRange(tier, index) {
      if (index === 0) {
        return `1-${tier.max}CBMç«‹æ–¹ç±³ï¼ˆåŒ…å«1CBMç«‹æ–¹ç±³åŠä»¥ä¸‹ï¼‰`
      } else if (tier.max === Infinity) {
        return `>${tier.min}CBMç«‹æ–¹ç±³ï¼ˆåŒ…å«${tier.min}CBMç«‹æ–¹ç±³ï¼‰`
      } else {
        return `${tier.min}-${tier.max}CBMç«‹æ–¹ç±³ï¼ˆåŒ…å«${tier.min}CBMç«‹æ–¹ç±³ï¼‰`
      }
    },
    saveUserInput(data) {
      const timestamp = new Date().toISOString()
      const inputData = {
        ...data,
        timestamp: timestamp,
        id: Date.now()
      }
      
      const existingData = JSON.parse(localStorage.getItem('bixd_user_inputs') || '[]')
      existingData.push(inputData)
      
      if (existingData.length > 100) {
        existingData.splice(0, existingData.length - 100)
      }
      
      localStorage.setItem('bixd_user_inputs', JSON.stringify(existingData))
    },
    calculateCost() {
      const { port, ukVolume, deVolume, alternativeOption, shipmentDate } = this.formData
      
      if (!port || (!ukVolume && !deVolume) || !alternativeOption) {
        alert('è¯·å¡«å†™å¿…è¦ä¿¡æ¯ Please fill in required information')
        return
      }

      let currentCost = 0
      let alternativeTitle = ''

      if (alternativeOption === 'agl') {
        currentCost = this.calculateAglCost(port, ukVolume, deVolume)
        alternativeTitle = 'AGLæ–¹æ¡ˆ AGL Solution (Non BIXD)'
      } else if (alternativeOption === '3pl') {
        const { ukUnitPrice, ukClearanceFee, deUnitPrice, deClearanceFee } = this.formData
        currentCost = this.calculateCurrentCost(ukUnitPrice, ukClearanceFee, deUnitPrice, deClearanceFee, ukVolume, deVolume)
        alternativeTitle = 'ä¸‰æ–¹æ‰¿è¿å•†æ–¹æ¡ˆ 3PL Solution'
      }

      this.saveUserInput(this.formData)

      const bixdResult = this.calculateBixdCost(port, ukVolume, deVolume, shipmentDate)
      const savings = currentCost - bixdResult.total
      const savingsPercentage = currentCost > 0 ? (savings / currentCost * 100) : 0

      this.results = {
        bixdTotal: bixdResult.total,
        currentTotal: currentCost,
        alternativeTitle: alternativeTitle,
        savingsPercentage: savingsPercentage,
        showEarlyBird: bixdResult.discount && bixdResult.discount.discount === 0.8
      }

      if (bixdResult.discount && bixdResult.discount.discount < 1) {
        const discountAmount = bixdResult.baseCost - bixdResult.total
        this.results.discountInfo = `${bixdResult.discount.name} (çœ${this.formatCurrency(discountAmount)})`
      } else {
        this.results.discountInfo = bixdResult.discount.name
      }

      if (savings > 0) {
        this.results.savingsText = `é¢„è®¡èŠ‚çœ Estimated Savings: ${this.formatCurrency(savings)}`
      } else if (savings < 0) {
        this.results.savingsText = `BIXDå¤šèŠ± BIXD costs more: ${this.formatCurrency(Math.abs(savings))}`
      } else {
        this.results.savingsText = `æˆæœ¬ç›¸åŒ Same cost`
      }

      this.showResults = true
    }
  }
}
</script>

<style scoped>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.container {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #f5f7fa;
  color: #333;
  line-height: 1.6;
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
}

header {
  text-align: center;
  margin-bottom: 30px;
}

header h1 {
  color: #2c3e50;
  margin-bottom: 15px;
  font-size: 28px;
}

.subtitle {
  font-size: 18px;
  color: #7f8c8d;
  font-weight: normal;
}

.description {
  background: #e8f4fd;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
  position: relative;
}

.description-toggle {
  background: none;
  border: none;
  color: #3498db;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 5px;
  width: 100%;
  text-align: left;
}

.description-content {
  margin-top: 15px;
  font-size: 14px;
  color: #555;
}

.description-content h3 {
  color: #2c3e50;
  margin-bottom: 10px;
  font-size: 16px;
}

.description-content ul {
  margin-left: 20px;
  margin-top: 8px;
}

.description-content li {
  margin-bottom: 8px;
}

.bixd-intro {
  background: white;
  border-radius: 8px;
  padding: 25px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}

.intro-title {
  font-size: 20px;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 15px;
  text-align: center;
}

.intro-content {
  font-size: 14px;
  line-height: 1.7;
  margin-bottom: 25px;
  text-align: left;
}

.advantages {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-top: 20px;
}

.advantage-card {
  padding: 20px;
  border-radius: 8px;
  color: white;
  text-align: center;
}

.advantage-card h4 {
  font-size: 18px;
  margin-bottom: 15px;
  font-weight: 600;
}

.advantage-card p {
  font-size: 13px;
  line-height: 1.5;
  text-align: left;
}

.advantage-1 { background: #232f3e; }
.advantage-2 { background: #ff9900; }
.advantage-3 { background: #146eb4; }
.advantage-4 { background: #ff6600; }

.calculator {
  background: white;
  border-radius: 8px;
  padding: 30px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}

.section-title {
  font-size: 18px;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #3498db;
}

.form-group {
  margin-bottom: 20px;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.form-section {
  border-top: 1px solid #eee;
  padding-top: 20px;
  margin-top: 20px;
}

.country-section {
  background: #f8f9fa;
  border-radius: 6px;
  padding: 15px;
  margin-bottom: 15px;
}

.country-title {
  font-weight: 600;
  color: #34495e;
  margin-bottom: 10px;
  font-size: 16px;
}

label {
  display: block;
  margin-bottom: 5px;
  font-weight: 500;
  color: #555;
  font-size: 14px;
}

input, select {
  width: 100%;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  transition: border-color 0.3s;
}

input:focus, select:focus {
  outline: none;
  border-color: #3498db;
}

.price-hint {
  font-size: 12px;
  color: #27ae60;
  margin-top: 5px;
  font-weight: 500;
}

.calculate-btn {
  width: 100%;
  background: #3498db;
  color: white;
  padding: 15px;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.3s;
  margin-top: 20px;
}

.calculate-btn:hover {
  background: #2980b9;
}

.results {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #eee;
}

.results h3 {
  margin-bottom: 20px;
  color: #2c3e50;
}

.comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}

.cost-item {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 6px;
  text-align: center;
}

.cost-item.bixd {
  border-left: 4px solid #27ae60;
}

.cost-item.current {
  border-left: 4px solid #e74c3c;
}

.cost-item h4 {
  margin-bottom: 10px;
  color: #555;
}

.price {
  font-size: 24px;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 5px;
}

.discount {
  font-size: 12px;
  color: #27ae60;
  font-weight: 500;
}

.savings {
  color: white;
  padding: 20px;
  border-radius: 6px;
  text-align: center;
  position: relative;
}

.savings .amount {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 5px;
}

.savings .percentage {
  font-size: 14px;
  opacity: 0.9;
}

.early-bird-tag {
  position: absolute;
  top: -8px;
  right: 10px;
  background: #f39c12;
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 500;
}

.price-table {
  background: #f8f9fa;
  border-radius: 6px;
  padding: 15px;
  margin-top: 10px;
}

.price-table table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
  border-radius: 6px;
  overflow: hidden;
}

.price-table th, .price-table td {
  padding: 12px 8px;
  text-align: center;
  border: none;
}

.price-table th {
  background: #1e3a8a;
  color: white;
  font-weight: 600;
}

.price-table tr:nth-child(even) {
  background: #e0f2fe;
}

.price-table tr:nth-child(odd) {
  background: #f0f9ff;
}

.price-table tr.highlighted {
  background: #fbbf24 !important;
  color: #1f2937;
  font-weight: 600;
}

.fixed-fee-note {
  font-size: 11px;
  color: #7f8c8d;
  font-style: italic;
  margin-top: 8px;
}

.disclaimer {
  background: #f8f9fa;
  border-radius: 6px;
  padding: 15px;
  margin-top: 30px;
  font-size: 12px;
  color: #7f8c8d;
  line-height: 1.5;
}

@media (max-width: 768px) {
  .form-row, .comparison {
    grid-template-columns: 1fr;
  }
  
  .advantages {
    grid-template-columns: 1fr;
  }
  
  .container {
    padding: 10px;
  }
  
  .calculator, .bixd-intro {
    padding: 20px;
  }
}
</style>
